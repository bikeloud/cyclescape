<% if @message.persisted? %>
  $("#new-message").before("<%= escape_javascript(render partial: 'messages/message', locals: { message: @message, thread: @thread } ) %>")
  tinyMCE.activeEditor.setContent('')
  $("#new-message").find("input[type=text], textarea, input[type=file]").not(":button, :submit, :reset").val('').trigger("change")
  window.mapInit()
  var el = document.getElementById("message-<%= @message.id %>")
  el.scrollIntoView()
  window.scrollBy(0, -80) // Top fix header
  $(el).addClass("new-message-highlight")
<% end %>
<%= render 'shared/flash' %>
<% if flash[:alert].present? %>
  $('html, body').animate({ scrollTop: 0 }, 0)
<% end %>
