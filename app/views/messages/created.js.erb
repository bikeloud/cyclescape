<% if @message.persisted? %>
  $('#messages-new-partial')
    .before("<%= j(render 'messages/message', message: @message, thread: @thread ) %>")
    .html("<%= j(render 'messages/new') %>")
    .find(".tabs").parent().tabs()
  window.mapInit()
  window.leafletMapInit()
  var el = document.getElementById("message-<%= @message.id %>")
  el.scrollIntoView()
  window.scrollBy(0, -80) // Top fix header
  $(el).addClass("new-message-highlight")
<% end %>
<%= render 'shared/flash' %>
<% if flash[:alert].present? %>
  $('html, body').animate({ scrollTop: 0 }, 0)
<% end %>
